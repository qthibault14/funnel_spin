!function(){"use strict";function Winwheel(t,e){let i={canvasId:"canvas",centerX:null,centerY:null,outerRadius:null,innerRadius:0,numSegments:1,drawMode:"code",rotationAngle:0,textFontFamily:"Arial",textFontSize:20,textFontWeight:"bold",textOrientation:"horizontal",textAlignment:"center",textDirection:"normal",textMargin:null,textFillStyle:"black",textStrokeStyle:null,textLineWidth:1,fillStyle:"silver",strokeStyle:"black",lineWidth:1,clearTheCanvas:!0,imageOverlay:!1,drawText:!0,pointerAngle:0,wheelImage:null,imageDirection:"N",responsive:!1,scaleFactor:1};for(let e in i)null!=t&&void 0!==t[e]?this[e]=t[e]:this[e]=i[e];if(null!=t)for(let e in t)void 0===this[e]&&(this[e]=t[e]);this.canvasId?(this.canvas=document.getElementById(this.canvasId),this.canvas?(null==this.centerX&&(this.centerX=this.canvas.width/2),null==this.centerY&&(this.centerY=this.canvas.height/2),null==this.outerRadius&&(this.canvas.width<this.canvas.height?this.outerRadius=this.canvas.width/2-this.lineWidth:this.outerRadius=this.canvas.height/2-this.lineWidth),this.ctx=this.canvas.getContext("2d")):(this.canvas=null,this.ctx=null)):(this.canvas=null,this.ctx=null),this.segments=new Array(null);for(let e=1;e<=this.numSegments;e++)null!=t&&t.segments&&void 0!==t.segments[e-1]?this.segments[e]=new Segment(t.segments[e-1]):this.segments[e]=new Segment;if(this.updateSegmentSizes(),null===this.textMargin&&(this.textMargin=this.textFontSize/1.7),null!=t&&t.animation&&void 0!==t.animation?this.animation=new Animation(t.animation):this.animation=new Animation,null!=t&&t.pins&&void 0!==t.pins&&(this.pins=new Pin(t.pins)),"image"==this.drawMode||"segmentImage"==this.drawMode?(void 0===t.fillStyle&&(this.fillStyle=null),void 0===t.strokeStyle&&(this.strokeStyle="red"),void 0===t.drawText&&(this.drawText=!1),void 0===t.lineWidth&&(this.lineWidth=1),void 0===e&&(e=!1)):void 0===e&&(e=!0),null!=t&&t.pointerGuide&&void 0!==t.pointerGuide?this.pointerGuide=new PointerGuide(t.pointerGuide):this.pointerGuide=new PointerGuide,this.responsive&&(winwheelToDrawDuringAnimation=this,this._originalCanvasWidth=this.canvas.width,this._originalCanvasHeight=this.canvas.height,this._responsiveScaleHeight=this.canvas.dataset.responsivescaleheight,this._responsiveMinWidth=this.canvas.dataset.responsiveminwidth,this._responsiveMinHeight=this.canvas.dataset.responsiveminheight,this._responsiveMargin=this.canvas.dataset.responsivemargin,window.addEventListener("load",winwheelResize),window.addEventListener("resize",winwheelResize)),1==e)this.draw(this.clearTheCanvas);else if("segmentImage"==this.drawMode){winwheelToDrawDuringAnimation=this,winhweelAlreadyDrawn=!1;for(let t=1;t<=this.numSegments;t++)null!==this.segments[t].image&&(this.segments[t].imgData=new Image,this.segments[t].imgData.onload=winwheelLoadedImage,this.segments[t].imgData.src=this.segments[t].image)}}function Pin(t){let e={visible:!0,number:36,outerRadius:3,fillStyle:"grey",strokeStyle:"black",lineWidth:1,margin:3,responsive:!1};for(let i in e)null!=t&&void 0!==t[i]?this[i]=t[i]:this[i]=e[i];if(null!=t)for(let e in t)void 0===this[e]&&(this[e]=t[e])}function Animation(t){let e={type:"spinOngoing",direction:"clockwise",propertyName:null,propertyValue:null,duration:10,yoyo:!1,repeat:null,easing:null,stopAngle:null,spins:null,clearTheCanvas:null,callbackFinished:null,callbackBefore:null,callbackAfter:null,callbackSound:null,soundTrigger:"segment"};for(let i in e)null!=t&&void 0!==t[i]?this[i]=t[i]:this[i]=e[i];if(null!=t)for(let e in t)void 0===this[e]&&(this[e]=t[e])}function Segment(t){let e={size:null,text:"",fillStyle:null,strokeStyle:null,lineWidth:null,textFontFamily:null,textFontSize:null,textFontWeight:null,textOrientation:null,textAlignment:null,textDirection:null,textMargin:null,textFillStyle:null,textStrokeStyle:null,textLineWidth:null,image:null,imageDirection:null,imgData:null};for(let i in e)null!=t&&void 0!==t[i]?this[i]=t[i]:this[i]=e[i];if(null!=t)for(let e in t)void 0===this[e]&&(this[e]=t[e]);this.startAngle=0,this.endAngle=0}function PointerGuide(t){let e={display:!1,strokeStyle:"red",lineWidth:3};for(let i in e)null!=t&&void 0!==t[i]?this[i]=t[i]:this[i]=e[i]}function winwheelAnimationLoop(){if(winwheelToDrawDuringAnimation){0!=winwheelToDrawDuringAnimation.animation.clearTheCanvas&&winwheelToDrawDuringAnimation.ctx.clearRect(0,0,winwheelToDrawDuringAnimation.canvas.width,winwheelToDrawDuringAnimation.canvas.height);let callbackBefore=winwheelToDrawDuringAnimation.animation.callbackBefore,callbackAfter=winwheelToDrawDuringAnimation.animation.callbackAfter;null!=callbackBefore&&("function"==typeof callbackBefore?callbackBefore():eval(callbackBefore)),winwheelToDrawDuringAnimation.draw(!1),null!=callbackAfter&&("function"==typeof callbackAfter?callbackAfter():eval(callbackAfter)),winwheelToDrawDuringAnimation.animation.callbackSound&&winwheelTriggerSound()}}function winwheelTriggerSound(){0==winwheelToDrawDuringAnimation.hasOwnProperty("_lastSoundTriggerNumber")&&(winwheelToDrawDuringAnimation._lastSoundTriggerNumber=0);let callbackSound=winwheelToDrawDuringAnimation.animation.callbackSound,currentTriggerNumber=0;currentTriggerNumber="pin"==winwheelToDrawDuringAnimation.animation.soundTrigger?winwheelToDrawDuringAnimation.getCurrentPinNumber():winwheelToDrawDuringAnimation.getIndicatedSegmentNumber(),currentTriggerNumber!=winwheelToDrawDuringAnimation._lastSoundTriggerNumber&&("function"==typeof callbackSound?callbackSound():eval(callbackSound),winwheelToDrawDuringAnimation._lastSoundTriggerNumber=currentTriggerNumber)}Winwheel.prototype.updateSegmentSizes=function(){if(this.segments){let t=0,e=0;for(let i=1;i<=this.numSegments;i++)null!==this.segments[i].size&&(t+=this.segments[i].size,e++);let i=360-t,n=0;i>0&&(n=i/(this.numSegments-e));let s=0;for(let t=1;t<=this.numSegments;t++)this.segments[t].startAngle=s,this.segments[t].size?s+=this.segments[t].size:s+=n,this.segments[t].endAngle=s}},Winwheel.prototype.clearCanvas=function(){this.ctx&&this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height)},Winwheel.prototype.draw=function(t){this.ctx&&(void 0!==t?1==t&&this.clearCanvas():this.clearCanvas(),"image"==this.drawMode?(this.drawWheelImage(),1==this.drawText&&this.drawSegmentText(),1==this.imageOverlay&&this.drawSegments()):"segmentImage"==this.drawMode?(this.drawSegmentImages(),1==this.drawText&&this.drawSegmentText(),1==this.imageOverlay&&this.drawSegments()):(this.drawSegments(),1==this.drawText&&this.drawSegmentText()),void 0!==this.pins&&1==this.pins.visible&&this.drawPins(),1==this.pointerGuide.display&&this.drawPointerGuide())},Winwheel.prototype.drawPins=function(){if(this.pins&&this.pins.number){let t=this.centerX*this.scaleFactor,e=this.centerY*this.scaleFactor,i=this.outerRadius*this.scaleFactor,n=this.pins.outerRadius,s=this.pins.margin;this.pins.responsive&&(n=this.pins.outerRadius*this.scaleFactor,s=this.pins.margin*this.scaleFactor);let a=360/this.pins.number;for(let o=1;o<=this.pins.number;o++)this.ctx.save(),this.ctx.strokeStyle=this.pins.strokeStyle,this.ctx.lineWidth=this.pins.lineWidth,this.ctx.fillStyle=this.pins.fillStyle,this.ctx.translate(t,e),this.ctx.rotate(this.degToRad(o*a+this.rotationAngle)),this.ctx.translate(-t,-e),this.ctx.beginPath(),this.ctx.arc(t,e-i+n+s,n,0,2*Math.PI),this.pins.fillStyle&&this.ctx.fill(),this.pins.strokeStyle&&this.ctx.stroke(),this.ctx.restore()}},Winwheel.prototype.drawPointerGuide=function(){if(this.ctx){let t=this.centerX*this.scaleFactor,e=this.centerY*this.scaleFactor,i=this.outerRadius*this.scaleFactor;this.ctx.save(),this.ctx.translate(t,e),this.ctx.rotate(this.degToRad(this.pointerAngle)),this.ctx.translate(-t,-e),this.ctx.strokeStyle=this.pointerGuide.strokeStyle,this.ctx.lineWidth=this.pointerGuide.lineWidth,this.ctx.beginPath(),this.ctx.moveTo(t,e),this.ctx.lineTo(t,-i/4),this.ctx.stroke(),this.ctx.restore()}},Winwheel.prototype.drawWheelImage=function(){if(null!=this.wheelImage){let t=this.centerX*this.scaleFactor,e=this.centerY*this.scaleFactor,i=this.wheelImage.width*this.scaleFactor,n=this.wheelImage.height*this.scaleFactor,s=t-i/2,a=e-n/2;this.ctx.save(),this.ctx.translate(t,e),this.ctx.rotate(this.degToRad(this.rotationAngle)),this.ctx.translate(-t,-e),this.ctx.drawImage(this.wheelImage,s,a,i,n),this.ctx.restore()}},Winwheel.prototype.drawSegmentImages=function(){if(this.ctx){let t=this.centerX*this.scaleFactor,e=this.centerY*this.scaleFactor;if(this.segments)for(let i=1;i<=this.numSegments;i++){let n=this.segments[i];if(n.imgData.height){let i=0,s=0,a=0,o="",l=n.imgData.width*this.scaleFactor,h=n.imgData.height*this.scaleFactor;"S"==(o=null!==n.imageDirection?n.imageDirection:this.imageDirection)?(i=t-l/2,s=e,a=n.startAngle+180+(n.endAngle-n.startAngle)/2):"E"==o?(i=t,s=e-h/2,a=n.startAngle+270+(n.endAngle-n.startAngle)/2):"W"==o?(i=t-l,s=e-h/2,a=n.startAngle+90+(n.endAngle-n.startAngle)/2):(i=t-l/2,s=e-h,a=n.startAngle+(n.endAngle-n.startAngle)/2),this.ctx.save(),this.ctx.translate(t,e),this.ctx.rotate(this.degToRad(this.rotationAngle+a)),this.ctx.translate(-t,-e),this.ctx.drawImage(n.imgData,i,s,l,h),this.ctx.restore()}else console.log("Segment "+i+" imgData is not loaded")}}},Winwheel.prototype.drawSegments=function(){if(this.ctx&&this.segments){let t=this.centerX*this.scaleFactor,e=this.centerY*this.scaleFactor,i=this.innerRadius*this.scaleFactor,n=this.outerRadius*this.scaleFactor;for(let s=1;s<=this.numSegments;s++){let a,o,l,h=this.segments[s];if(a=null!==h.fillStyle?h.fillStyle:this.fillStyle,this.ctx.fillStyle=a,o=null!==h.lineWidth?h.lineWidth:this.lineWidth,this.ctx.lineWidth=o,l=null!==h.strokeStyle?h.strokeStyle:this.strokeStyle,this.ctx.strokeStyle=l,l||a){if(this.ctx.beginPath(),this.innerRadius){let n=Math.cos(this.degToRad(h.startAngle+this.rotationAngle-90))*(i-o/2),s=Math.sin(this.degToRad(h.startAngle+this.rotationAngle-90))*(i-o/2);this.ctx.moveTo(t+n,e+s)}else this.ctx.moveTo(t,e);this.ctx.arc(t,e,n,this.degToRad(h.startAngle+this.rotationAngle-90),this.degToRad(h.endAngle+this.rotationAngle-90),!1),this.innerRadius?this.ctx.arc(t,e,i,this.degToRad(h.endAngle+this.rotationAngle-90),this.degToRad(h.startAngle+this.rotationAngle-90),!0):this.ctx.lineTo(t,e),a&&this.ctx.fill(),l&&this.ctx.stroke()}}}},Winwheel.prototype.drawSegmentText=function(){if(this.ctx){let t,e,i,n,s,a,o,l,h,r,c=this.centerX*this.scaleFactor,g=this.centerY*this.scaleFactor,m=this.outerRadius*this.scaleFactor,u=this.innerRadius*this.scaleFactor;for(let d=1;d<=this.numSegments;d++){this.ctx.save();let w=this.segments[d];if(w.text){t=null!==w.textFontFamily?w.textFontFamily:this.textFontFamily,e=null!==w.textFontSize?w.textFontSize:this.textFontSize,i=null!==w.textFontWeight?w.textFontWeight:this.textFontWeight,n=null!==w.textOrientation?w.textOrientation:this.textOrientation,s=null!==w.textAlignment?w.textAlignment:this.textAlignment,a=null!==w.textDirection?w.textDirection:this.textDirection,o=null!==w.textMargin?w.textMargin:this.textMargin,l=null!==w.textFillStyle?w.textFillStyle:this.textFillStyle,h=null!==w.textStrokeStyle?w.textStrokeStyle:this.textStrokeStyle,r=null!==w.textLineWidth?w.textLineWidth:this.textLineWidth,e*=this.scaleFactor,o*=this.scaleFactor;let d="";null!=i&&(d+=i+" "),null!=e&&(d+=e+"px "),null!=t&&(d+=t),this.ctx.font=d,this.ctx.fillStyle=l,this.ctx.strokeStyle=h,this.ctx.lineWidth=r;let p=w.text.split("\n"),x=0-e*(p.length/2)+e/2;"curved"!=n||"inner"!=s&&"outer"!=s||(x=0);for(let t=0;t<p.length;t++){if("reversed"==a){if("horizontal"==n){this.ctx.textAlign="inner"==s?"right":"outer"==s?"left":"center",this.ctx.textBaseline="middle";let e=this.degToRad(w.endAngle-(w.endAngle-w.startAngle)/2+this.rotationAngle-90-180);this.ctx.save(),this.ctx.translate(c,g),this.ctx.rotate(e),this.ctx.translate(-c,-g),"inner"==s?(l&&this.ctx.fillText(p[t],c-u-o,g+x),h&&this.ctx.strokeText(p[t],c-u-o,g+x)):"outer"==s?(l&&this.ctx.fillText(p[t],c-m+o,g+x),h&&this.ctx.strokeText(p[t],c-m+o,g+x)):(l&&this.ctx.fillText(p[t],c-u-(m-u)/2-o,g+x),h&&this.ctx.strokeText(p[t],c-u-(m-u)/2-o,g+x)),this.ctx.restore()}else if("vertical"==n){this.ctx.textAlign="center",this.ctx.textBaseline="inner"==s?"top":"outer"==s?"bottom":"middle";let i=w.endAngle-(w.endAngle-w.startAngle)/2-180;i+=this.rotationAngle,this.ctx.save(),this.ctx.translate(c,g),this.ctx.rotate(this.degToRad(i)),this.ctx.translate(-c,-g);let n=0;"outer"==s?n=g+m-o:"inner"==s&&(n=g+u+o);let a=e-e/9;if("outer"==s)for(let e=p[t].length-1;e>=0;e--){let i=p[t].charAt(e);l&&this.ctx.fillText(i,c+x,n),h&&this.ctx.strokeText(i,c+x,n),n-=a}else if("inner"==s)for(let e=0;e<p[t].length;e++){let i=p[t].charAt(e);l&&this.ctx.fillText(i,c+x,n),h&&this.ctx.strokeText(i,c+x,n),n+=a}else if("center"==s){let e=0;p[t].length>1&&(e=a*(p[t].length-1)/2);let i=g+u+(m-u)/2+e+o;for(let e=p[t].length-1;e>=0;e--){let n=p[t].charAt(e);l&&this.ctx.fillText(n,c+x,i),h&&this.ctx.strokeText(n,c+x,i),i-=a}}this.ctx.restore()}else if("curved"==n){let i=0;"inner"==s?(i=u+o,this.ctx.textBaseline="top"):"outer"==s?(i=m-o,this.ctx.textBaseline="bottom",i-=e*(p.length-1)):"center"==s&&(i=u+o+(m-u)/2,this.ctx.textBaseline="middle");let n=0,a=0;if(p[t].length>1){this.ctx.textAlign="left",n=e/10*4;let s=(n*=100/i)*p[t].length;a=w.startAngle+((w.endAngle-w.startAngle)/2-s/2)}else a=w.startAngle+(w.endAngle-w.startAngle)/2,this.ctx.textAlign="center";a+=this.rotationAngle,a-=180;for(let e=p[t].length;e>=0;e--){this.ctx.save();let s=p[t].charAt(e);this.ctx.translate(c,g),this.ctx.rotate(this.degToRad(a)),this.ctx.translate(-c,-g),h&&this.ctx.strokeText(s,c,g+i+x),l&&this.ctx.fillText(s,c,g+i+x),a+=n,this.ctx.restore()}}}else if("horizontal"==n){this.ctx.textAlign="inner"==s?"left":"outer"==s?"right":"center",this.ctx.textBaseline="middle";let e=this.degToRad(w.endAngle-(w.endAngle-w.startAngle)/2+this.rotationAngle-90);this.ctx.save(),this.ctx.translate(c,g),this.ctx.rotate(e),this.ctx.translate(-c,-g),"inner"==s?(l&&this.ctx.fillText(p[t],c+u+o,g+x),h&&this.ctx.strokeText(p[t],c+u+o,g+x)):"outer"==s?(l&&this.ctx.fillText(p[t],c+m-o,g+x),h&&this.ctx.strokeText(p[t],c+m-o,g+x)):(l&&this.ctx.fillText(p[t],c+u+(m-u)/2+o,g+x),h&&this.ctx.strokeText(p[t],c+u+(m-u)/2+o,g+x)),this.ctx.restore()}else if("vertical"==n){this.ctx.textAlign="center",this.ctx.textBaseline="inner"==s?"bottom":"outer"==s?"top":"middle";let i=w.endAngle-(w.endAngle-w.startAngle)/2;i+=this.rotationAngle,this.ctx.save(),this.ctx.translate(c,g),this.ctx.rotate(this.degToRad(i)),this.ctx.translate(-c,-g);let n=0;"outer"==s?n=g-m+o:"inner"==s&&(n=g-u-o);let a=e-e/9;if("outer"==s)for(let e=0;e<p[t].length;e++){let i=p[t].charAt(e);l&&this.ctx.fillText(i,c+x,n),h&&this.ctx.strokeText(i,c+x,n),n+=a}else if("inner"==s)for(let e=p[t].length-1;e>=0;e--){let i=p[t].charAt(e);l&&this.ctx.fillText(i,c+x,n),h&&this.ctx.strokeText(i,c+x,n),n-=a}else if("center"==s){let e=0;p[t].length>1&&(e=a*(p[t].length-1)/2);let i=g-u-(m-u)/2-e-o;for(let e=0;e<p[t].length;e++){let n=p[t].charAt(e);l&&this.ctx.fillText(n,c+x,i),h&&this.ctx.strokeText(n,c+x,i),i+=a}}this.ctx.restore()}else if("curved"==n){let i=0;"inner"==s?(i=u+o,this.ctx.textBaseline="bottom",i+=e*(p.length-1)):"outer"==s?(i=m-o,this.ctx.textBaseline="top"):"center"==s&&(i=u+o+(m-u)/2,this.ctx.textBaseline="middle");let n=0,a=0;if(p[t].length>1){this.ctx.textAlign="left",n=e/10*4;let s=(n*=100/i)*p[t].length;a=w.startAngle+((w.endAngle-w.startAngle)/2-s/2)}else a=w.startAngle+(w.endAngle-w.startAngle)/2,this.ctx.textAlign="center";a+=this.rotationAngle;for(let e=0;e<p[t].length;e++){this.ctx.save();let s=p[t].charAt(e);this.ctx.translate(c,g),this.ctx.rotate(this.degToRad(a)),this.ctx.translate(-c,-g),h&&this.ctx.strokeText(s,c,g-i+x),l&&this.ctx.fillText(s,c,g-i+x),a+=n,this.ctx.restore()}}x+=e}}this.ctx.restore()}}},Winwheel.prototype.degToRad=function(t){return.017453292519943295*t},Winwheel.prototype.setCenter=function(t,e){this.centerX=t,this.centerY=e},Winwheel.prototype.addSegment=function(t,e){let i,n=new Segment(t);if(this.numSegments++,void 0!==e){for(let t=this.numSegments;t>e;t--)this.segments[t]=this.segments[t-1];this.segments[e]=n,i=e}else this.segments[this.numSegments]=n,i=this.numSegments;return this.updateSegmentSizes(),this.segments[i]},Winwheel.prototype.setCanvasId=function(t){t?(this.canvasId=t,this.canvas=document.getElementById(this.canvasId),this.canvas&&(this.ctx=this.canvas.getContext("2d"))):(this.canvasId=null,this.ctx=null,this.canvas=null)},Winwheel.prototype.deleteSegment=function(t){if(this.numSegments>1){if(void 0!==t)for(let e=t;e<this.numSegments;e++)this.segments[e]=this.segments[e+1];this.segments[this.numSegments]=void 0,this.numSegments--,this.updateSegmentSizes()}},Winwheel.prototype.windowToCanvas=function(t,e){let i=this.canvas.getBoundingClientRect();return{x:Math.floor(t-i.left*(this.canvas.width/i.width)),y:Math.floor(e-i.top*(this.canvas.height/i.height))}},Winwheel.prototype.getSegmentAt=function(t,e){let i=null,n=this.getSegmentNumberAt(t,e);return null!==n&&(i=this.segments[n]),i},Winwheel.prototype.getSegmentNumberAt=function(t,e){let i,n,s,a,o,l=this.windowToCanvas(t,e),h=this.centerX*this.scaleFactor,r=this.centerY*this.scaleFactor,c=this.outerRadius*this.scaleFactor,g=this.innerRadius*this.scaleFactor;l.x>h?(s=l.x-h,n="R"):(s=h-l.x,n="L"),l.y>r?(a=l.y-r,i="B"):(a=r-l.y,i="T");let m=a/s,u=180*Math.atan(m)/Math.PI,d=0;if(o=Math.sqrt(a*a+s*s),"T"==i&&"R"==n?d=Math.round(90-u):"B"==i&&"R"==n?d=Math.round(u+90):"B"==i&&"L"==n?d=Math.round(90-u+180):"T"==i&&"L"==n&&(d=Math.round(u+270)),0!=this.rotationAngle){(d-=this.getRotationPosition())<0&&(d=360-Math.abs(d))}let w=null;for(let t=1;t<=this.numSegments;t++)if(d>=this.segments[t].startAngle&&d<=this.segments[t].endAngle&&o>=g&&o<=c){w=t;break}return w},Winwheel.prototype.getIndicatedSegment=function(){let t=this.getIndicatedSegmentNumber();return this.segments[t]},Winwheel.prototype.getIndicatedSegmentNumber=function(){let t=0,e=this.getRotationPosition(),i=Math.floor(this.pointerAngle-e);i<0&&(i=360-Math.abs(i));for(let e=1;e<this.segments.length;e++)if(i>=this.segments[e].startAngle&&i<=this.segments[e].endAngle){t=e;break}return t},Winwheel.prototype.getCurrentPinNumber=function(){let t=0;if(this.pins){let e=this.getRotationPosition(),i=Math.floor(this.pointerAngle-e);i<0&&(i=360-Math.abs(i));let n=360/this.pins.number,s=0;for(let e=0;e<this.pins.number;e++){if(i>=s&&i<=s+n){t=e;break}s+=n}"clockwise"==this.animation.direction&&++t>this.pins.number&&(t=0)}return t},Winwheel.prototype.getRotationPosition=function(){let t=this.rotationAngle;if(t>=0){if(t>360){t-=360*Math.floor(t/360)}}else{if(t<-360){t-=360*Math.ceil(t/360)}t=360+t}return t},Winwheel.prototype.startAnimation=function(){if(this.animation){this.computeAnimation(),winwheelToDrawDuringAnimation=this;let t=new Array(null);t[this.animation.propertyName]=this.animation.propertyValue,t.yoyo=this.animation.yoyo,t.repeat=this.animation.repeat,t.ease=this.animation.easing,t.onUpdate=winwheelAnimationLoop,t.onComplete=winwheelStopAnimation,this.tween=TweenMax.to(this,this.animation.duration,t)}},Winwheel.prototype.stopAnimation=function(t){winwheelToDrawDuringAnimation&&(winwheelToDrawDuringAnimation.tween&&winwheelToDrawDuringAnimation.tween.kill(),winwheelStopAnimation(t)),winwheelToDrawDuringAnimation=this},Winwheel.prototype.pauseAnimation=function(){this.tween&&this.tween.pause()},Winwheel.prototype.resumeAnimation=function(){this.tween&&this.tween.play()},Winwheel.prototype.computeAnimation=function(){this.animation&&("spinOngoing"==this.animation.type?(this.animation.propertyName="rotationAngle",null==this.animation.spins&&(this.animation.spins=5),null==this.animation.repeat&&(this.animation.repeat=-1),null==this.animation.easing&&(this.animation.easing="Linear.easeNone"),null==this.animation.yoyo&&(this.animation.yoyo=!1),this.animation.propertyValue=360*this.animation.spins,"anti-clockwise"==this.animation.direction&&(this.animation.propertyValue=0-this.animation.propertyValue)):"spinToStop"==this.animation.type?(this.animation.propertyName="rotationAngle",null==this.animation.spins&&(this.animation.spins=5),null==this.animation.repeat&&(this.animation.repeat=0),null==this.animation.easing&&(this.animation.easing="Power3.easeOut"),null==this.animation.stopAngle?this.animation._stopAngle=Math.floor(359*Math.random()):this.animation._stopAngle=360-this.animation.stopAngle+this.pointerAngle,null==this.animation.yoyo&&(this.animation.yoyo=!1),this.animation.propertyValue=360*this.animation.spins,"anti-clockwise"==this.animation.direction?(this.animation.propertyValue=0-this.animation.propertyValue,this.animation.propertyValue-=360-this.animation._stopAngle):this.animation.propertyValue+=this.animation._stopAngle):"spinAndBack"==this.animation.type?(this.animation.propertyName="rotationAngle",null==this.animation.spins&&(this.animation.spins=5),null==this.animation.repeat&&(this.animation.repeat=1),null==this.animation.easing&&(this.animation.easing="Power2.easeInOut"),null==this.animation.yoyo&&(this.animation.yoyo=!0),null==this.animation.stopAngle?this.animation._stopAngle=0:this.animation._stopAngle=360-this.animation.stopAngle,this.animation.propertyValue=360*this.animation.spins,"anti-clockwise"==this.animation.direction?(this.animation.propertyValue=0-this.animation.propertyValue,this.animation.propertyValue-=360-this.animation._stopAngle):this.animation.propertyValue+=this.animation._stopAngle):this.animation.type)},Winwheel.prototype.getRandomForSegment=function(t){let e=0;if(t)if(void 0!==this.segments[t]){let i=this.segments[t].startAngle,n=this.segments[t].endAngle-i-2;n>0?e=i+1+Math.floor(Math.random()*n):console.log("Segment size is too small to safely get random angle inside it")}else console.log("Segment "+t+" undefined");else console.log("Segment number not specified");return e},Segment.prototype.changeImage=function(t,e){this.image=t,this.imgData=null,e&&(this.imageDirection=e),winhweelAlreadyDrawn=!1,this.imgData=new Image,this.imgData.onload=winwheelLoadedImage,this.imgData.src=this.image};let winwheelToDrawDuringAnimation=null;function winwheelStopAnimation(canCallback){if(0!=canCallback){let callback=winwheelToDrawDuringAnimation.animation.callbackFinished;null!=callback&&("function"==typeof callback?callback(winwheelToDrawDuringAnimation.getIndicatedSegment()):eval(callback))}}let winhweelAlreadyDrawn=!1;function winwheelLoadedImage(){if(0==winhweelAlreadyDrawn){let t=0;for(let e=1;e<=winwheelToDrawDuringAnimation.numSegments;e++)null!=winwheelToDrawDuringAnimation.segments[e].imgData&&winwheelToDrawDuringAnimation.segments[e].imgData.height&&t++;t==winwheelToDrawDuringAnimation.numSegments&&(winhweelAlreadyDrawn=!0,winwheelToDrawDuringAnimation.draw())}}function winwheelResize(){let t=40;void 0!==winwheelToDrawDuringAnimation._responsiveMargin&&(t=winwheelToDrawDuringAnimation._responsiveMargin);let e=window.innerWidth-t,i=winwheelToDrawDuringAnimation._responsiveMinWidth,n=winwheelToDrawDuringAnimation._responsiveMinHeight;e<i?e=i:e>winwheelToDrawDuringAnimation._originalCanvasWidth&&(e=winwheelToDrawDuringAnimation._originalCanvasWidth);let s=e/winwheelToDrawDuringAnimation._originalCanvasWidth;if(winwheelToDrawDuringAnimation.canvas.width=winwheelToDrawDuringAnimation._originalCanvasWidth*s,winwheelToDrawDuringAnimation._responsiveScaleHeight){let t=winwheelToDrawDuringAnimation._originalCanvasHeight*s;t<n?t=n:t>winwheelToDrawDuringAnimation._originalCanvasHeight&&(t=winwheelToDrawDuringAnimation._originalCanvasHeight),winwheelToDrawDuringAnimation.canvas.height=t}winwheelToDrawDuringAnimation.scaleFactor=s,winwheelToDrawDuringAnimation.draw()}function degToRad(t){return t*(Math.PI/180)}function delay(t){return new Promise(e=>{setTimeout(e,t)})}function loadImage(t){return new Promise((e,i)=>{const n=new Image;n.onload=t=>{e(n)},n.onerror=i,n.src=t})}function scaleImage(t,e){t.width*=e,t.height*=e}class SpinWheel{constructor(t,e){e=Object.assign({drawText:!0,textMargin:0,rotationAngle:0,animation:{}},e),this.image=e.image,this.decals=e.decals,this.decalsBelowWheel=this.decals.filter(t=>t.belowWheel),this.decalsAboveWheel=this.decals.filter(t=>!t.belowWheel);const i=e.radius,n=2*e.radius;this.scale=n/this.image.height,scaleImage(this.image,this.scale),this.pinOffset=e.pinOffset,this.pinRadius=e.pinRadius,this.radius=e.radius/this.scale,this.pinCircleRadius=this.radius-this.pinOffset+this.pinRadius,this.canvas=t,this.ctx=this.canvas.getContext("2d"),this.x=i,this.y=i,this.pointer=new SpinWheelPointer(this,e.pointer),this.canvas.width=i+(this.pointer.pivotDistance+this.pointer.image.width-this.pointer.pivotX)*this.scale,this.canvas.height=n,this.initialRotationAngle=e.rotationAngle,this.animationStopCallbacks=[],this.winwheel=new Winwheel({canvasId:t.id,centerX:this.x,centerY:this.y,drawMode:"image",outerRadius:e.radius,textAlignment:"outer",drawText:e.drawText,textMargin:e.textMargin*this.scale,rotationAngle:e.rotationAngle,pointerAngle:e.pointer.angle,animation:{type:"spinToStop",direction:"clockwise",easing:"Power1.easeOut",...e.animation,callbackBefore:()=>{this.drawUnder()},callbackFinished:t=>{this.animationStopCallbacks.forEach(e=>{const i=this.pointer.getAngleOfClosestPin();if(0!==this.pointer.rotation&&i>=this.pointer.wheelOffsetAngleDeg){const e=this.winwheel.getIndicatedSegmentNumber()-1;t=this.winwheel.segments[(e+1)%this.numSegments+1]}e(t)})},callbackAfter:()=>{this.drawOnTop()}},numSegments:e.numSegments,segments:e.segments}),this.numSegments=e.numSegments,this.winwheel.wheelImage=this.image,this.spinning=!1}spin({stopSegment:t,animationOptions:e}={}){return new Promise(i=>{if(!this.spinning){if(this.spinning=!0,this.winwheel.rotationAngle=this.winwheel.rotationAngle%360,"object"==typeof e&&Object.assign(this.winwheel.animation,e),this.winwheel.animation.direction="clockwise","number"==typeof t){const e=this.winwheel.getRandomForSegment(t);this.winwheel.animation.stopAngle=e}this.winwheel.startAnimation()}this.animationStopCallbacks.push(e=>{let n;this.spinning=!1,"number"==typeof t?(e=this.winwheel.segments[t],n=t,console.log("Guaranteed correct segment by setting it",n)):n=this.winwheel.getIndicatedSegmentNumber(),i({segment:e,segmentNumber:n})})})}drawDecal({image:t,rotates:e=!1}){this.ctx.save(),this.ctx.translate(this.x,this.y),e?this.ctx.rotate(degToRad(this.winwheel.getRotationPosition())):this.ctx.rotate(degToRad(this.initialRotationAngle)),this.ctx.scale(this.scale,this.scale),this.ctx.translate(-t.width/2,-t.height/2),this.ctx.drawImage(t,0,0),this.ctx.restore()}drawUnder(){this.decalsBelowWheel.forEach(t=>this.drawDecal(t))}draw(){this.drawUnder(),this.winwheel.draw(!1),this.drawOnTop()}drawOnTop(){this.decalsAboveWheel.forEach(t=>this.drawDecal(t)),this.pointer.draw()}}class SpinWheelPointer{constructor(t,{image:e,pivotX:i,pivotY:n,tipXOffset:s=0,angle:a=90,triangle:o,pinDistance:l}){this.wheel=t,this.image=e,this.scale=this.wheel.scale,this.centerXOffset=i,this.pivotX=i,this.pivotY=n,void 0===n&&(this.pivotX=this.image.height/2),this.tipXOffset=s,this.wheelOffsetAngleDeg=a,this.triangle=o;const h=this.triangle.height;void 0===l&&(l=(this.pivotX-h-this.tipXOffset)/3),this.pivotDistance=this.wheel.pinCircleRadius+h+l,this.ctx=this.wheel.ctx,this.calc={triangleHyp:Math.sqrt(this.triangle.height**2+this.triangle.width**2),alpha:Math.atan(this.triangle.width/this.triangle.height),i:this.triangle.width-this.pivotX+this.tipXOffset},l>this.triangle.width-h-this.calc.i&&console.error("Pointer is too far away and will never touch the pins"),this.rotation=0,this.transitionedRotation=0,this.rotationSmoothing=1.5,this.snapback=!1}calculateRotation(t,e,i,n,s,a){let o=!1;if(s<0&&(o=!0,s=-s),t+e<=n)throw new Error("Error");if(i+t>n)throw new Error("Pointer overlaps pin");let l=Math.sqrt(t**2+n**2-2*t*n*Math.cos(s)),h=Math.acos((n**2+l**2-t**2)/(2*l*n)),r=i*Math.cos(this.calc.alpha),c=Math.sqrt(l**2-i**2*Math.sin(this.calc.alpha)**2),g=r+c;g<=0&&(g=r-c);let m,u=this.calc.triangleHyp-g,d=Math.acos((l**2+e**2-u**2)/(2*l*e));if(o)(m=d-h)<0&&(m=0);else{m=h+d;const t=a*this.calc.triangleHyp/e;g>this.calc.triangleHyp-t&&(m=0,this.snapback=!0)}return 0!==m&&(this.snapback=!1),m}getAngleOfClosestPin(){const t=this.wheel.winwheel.getRotationPosition(),e=360/this.wheel.numSegments,i=this.wheel.winwheel.getIndicatedSegmentNumber()-1,n=[];for(let i=0;i<this.wheel.numSegments;i++){const s=(i*e+t)%360;n.push(s)}const s=i,a=(i+1)%this.wheel.numSegments;let o;return n[o=Math.abs(this.wheelOffsetAngleDeg-n[s])>Math.abs(this.wheelOffsetAngleDeg-n[a])?a:s]}getRotation(){const t=this.getAngleOfClosestPin()-this.wheelOffsetAngleDeg;return-this.calculateRotation(this.wheel.pinCircleRadius,this.triangle.width,this.triangle.height,this.pivotDistance,degToRad(t),this.calc.i)}draw(){this.rotation=this.getRotation(),this.snapback?this.transitionedRotation+=(this.rotation-this.transitionedRotation)/this.rotationSmoothing:this.transitionedRotation=this.rotation,this.ctx.save(),this.ctx.translate(this.wheel.x,this.wheel.y),this.ctx.rotate(degToRad(this.wheelOffsetAngleDeg-90)),this.ctx.scale(this.scale,this.scale),this.ctx.translate(this.pivotDistance,0),this.ctx.rotate(this.transitionedRotation),this.ctx.translate(-this.pivotX,-this.pivotY),this.ctx.drawImage(this.image,0,0),this.ctx.restore()}}class WheelPanel{constructor(t,e,i){this.options=Object.assign({transitionDuration:500,sectionHideTransition:200,backgroundColor:"rgb(12, 12, 12)"},i),this.wrapper=t,this.spinWheelOptions=e,this.createdWheel=!1,this.wheelWasSpun=!1,this.visible=!1,this.selectedPromo=null,this.el=this.wrapper.querySelector(".wheel-panel"),this.canvasWrapper=this.wrapper.querySelector(".wheel-panel__canvas_wrapper"),this.contentEl=this.wrapper.querySelector(".wheel-panel__content"),this.updateCustomization(),this.closeButton=this.wrapper.querySelector(".wheel-panel__close"),this.closeButton.onclick=()=>{this.hide()},this.form=this.wrapper.querySelector(".wheel-panel__form"),this.form.onsubmit=t=>{t.preventDefault(),this.formSubmit()},this.enterEmailSection=this.wrapper.querySelector(".wheel-panel__enter-email"),this.enterEmailSection.classList.add("active"),this.enterEmailSection.style.display="block",this.thankYouSection=this.wrapper.querySelector(".wheel-panel__thank-you"),this.thankYouSection.classList.remove("active"),this.thankYouSection.style.display="none",this.usePromoButton=this.thankYouSection.querySelector(".use-promo-button"),this.usePromoButton.disabled=!0,this.usePromoButton.onclick=()=>{this.usePromo()}}updateCustomization(){const t=`${this.options.transitionDuration}ms`;this.el.style.transitionDuration=t,this.canvasWrapper.style.transitionDuration=t,this.contentEl.style.transitionDuration=t,this.wrapper.querySelectorAll(".wheel-panel-section").forEach(t=>t.style.transitionDuration=`${this.options.sectionHideTransition}ms`),this.options.backgroundColor&&(this.el.style.backgroundColor=this.options.backgroundColor),this.options.backgroundImage&&(this.el.style.backgroundImage=`url(${this.options.backgroundImage})`),this.options.fontColor&&(this.el.style.color=this.options.fontColor),this.options.fontFamily&&(this.el.style.fontFamily=this.options.fontFamily);const e=this.wrapper.querySelectorAll(".button");if(this.options.buttonFontColor&&e.forEach(t=>t.style.color=this.options.buttonFontColor),this.options.buttonBackgroundColor&&e.forEach(t=>t.style.background=this.options.buttonBackgroundColor),this.options.headerFontColor){this.wrapper.querySelectorAll(".header").forEach(t=>t.style.color=this.options.headerFontColor)}}createWheel(){const t=this.canvasWrapper.querySelector("#spin-wheel-canvas");this.wheel=new SpinWheel(t,{radius:this.canvasWrapper.clientHeight,...this.spinWheelOptions}),this.wheel.draw()}async show(){this.wrapper.style.display="block",await delay(1),this.createdWheel||(this.createWheel(),this.createdWheel=!0),this.wrapper.classList.add("visible"),this.visible=!0,await delay(this.options.transitionDuration)}async hide(){await delay(1),this.wrapper.classList.remove("visible"),this.visible=!1,await delay(this.options.transitionDuration),this.wrapper.style.display="none"}toggle(){this.visible?this.hide():this.show()}toggleTextSection(t,e=null){return new Promise(async(i,n)=>{try{const n=this.wrapper.querySelector(t);"boolean"!=typeof e&&n.classList.contains("active")||!e?(n.classList.remove("active"),await delay(this.options.sectionHideTransition),n.style.display="none",i()):(n.style.display="block",await delay(1),n.classList.add("active"),await delay(this.options.sectionHideTransition),i())}catch(t){n(t)}})}getPromoFromSegmentNumber(t){return t.toString()}async formSubmit(){if(this.wheelWasSpun)return;if(this.form.checkValidity()){this.wheelWasSpun=!0;const t=this.form.elements.email.value;console.log("User submitted email: ",t),this.toggleTextSection(".wheel-panel__enter-email",!1);const{segment:e,segmentNumber:i}=await this.wheel.spin({stopSegment:4});this.showPrize({name:e.text,code:this.getPromoFromSegmentNumber(i)})}}async showPrize(t){this.selectedPromo=t,this.thankYouSection.querySelector(".promo-name").textContent=t.name,this.thankYouSection.querySelector('[name="promo"]').value=t.code,this.usePromoButton.disabled=!1,await this.toggleTextSection(".wheel-panel__thank-you",!0)}usePromo(){console.log(this.selectedPromo),this.hide()}}async function init(){const t={image:await loadImage("./assets/images/pointer.png"),pivotX:186,pivotY:94,triangle:{height:107,width:168},tipXOffset:23},e=(await loadImage("./assets/images/pointer2.png"),{image:await loadImage("./assets/images/wheel.png"),pinOffset:81,pinRadius:10,numSegments:12,rotationAngle:-15,pointer:{...t,angle:90},textMargin:196,segments:[{text:"20% OFF"},{text:"No luck today"},{text:"10%OFF"},{text:"Almost"},{text:"40% OFF"},{text:"Nothing"},{text:"50% OFF"},{text:"Sorry!"},{text:"60% OFF"},{text:"Nope"},{text:"70% OFF"},{text:"Not sorry"}],decals:[{image:await loadImage("./assets/images/wheel-shadow.png")},{image:await loadImage("./assets/images/wheel-ring.png"),rotates:!0},{image:await loadImage("./assets/images/wheel-center.png")}],animation:{duration:5,spins:2}}),i=document.querySelector(".wheel-panel-wrapper"),n=new WheelPanel(i,e,{backgroundImage:"./assets/images/black_friday_bg.png",fontColor:"#fff",buttonBackgroundColor:"rgb(216, 33, 33)"});document.querySelector("#toggle-panel").onclick=()=>{n.toggle()}}window.onload=()=>{init()}}();
